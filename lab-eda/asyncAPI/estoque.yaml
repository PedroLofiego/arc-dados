asyncapi: '2.6.0'
info:
  title: Lab Arquitetura de dados
  version: '1.0.0'
  description: |
    Curso de extensão de arquitetura de dados
    ### Confira a grade do curso:
    * Introdução à arquitetura de dados
    * Storage
    * Event-Driven Arquitetura    
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0
servers:
  test:
    url: kafka:9092
    protocol: kafka-secure
    description: Test broker
    security:
      - saslScram: []
defaultContentType: application/json
channels:
  logistica.estoque.alterado.v1:
    description: Estoque alterado.
    parameters:
      estoqueID:
        $ref: '#/components/parameters/estoqueID'
    publish:
      summary: Informação de estoque alterado
      operationId: estoque-alterado
      traits:
        - $ref: '#/components/operationTraits/kafka'
      message:
        $ref: '#/components/messages/estoque' 
components:
  messages:
    estoque:
      name: estoque
      title: Estoque
      summary: Informações de mudanças de cada produto.
      contentType: application/json
      traits:
        - $ref: '#/components/messageTraits/commonHeaders'
      payload:
        $ref: "#/components/schemas/estoquePayload"  
  schemas:
    estoquePayload:
      type: object
      properties:
        idEstoque:
          type: integer
          minimum: 0
          description: Identificação estoque.
        idProduto:
          type: integer
          minimum: 0
          description: Produto.
        quantidadeDisponivel:
          type: integer
          minimum: 0
          description: Quantidade disponivel do produto.
        dtEstoque:
          $ref: "#/components/schemas/dtEstoque"  
  
    dtEstoque:
      type: string
      format: date-time
      description: Data estoque.
  securitySchemes:
    saslScram:
      type: scramSha256
      description: Provide your username and password for SASL/SCRAM authentication
  parameters:
    estoqueID:
      description: Identificação do estoque.
      schema:
        type: string
  messageTraits:
    commonHeaders:
      headers:
        type: object
        properties:
          my-app-header:
            type: integer
            minimum: 0
            maximum: 100
  operationTraits:
    kafka:
      bindings:
        kafka:
          clientId: my-app-id
